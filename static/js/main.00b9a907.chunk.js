(this["webpackJsonpdata-utils"]=this["webpackJsonpdata-utils"]||[]).push([[0],{20:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){"use strict";n.r(t);var a=n(1),s=n.n(a),r=n(13),c=n.n(r),o=(n(20),n(3)),i=n(4),l=n(2),u=n(6),d=n(5),p=n(14),h=n.n(p),b=n(0),j=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){var t=e.target.files[0];t&&a.setState({file:t},(function(){a.props.addEvent&&a.props.addEvent(a.state.file)}))},a.state={file:void 0},a.handleChange=a.handleChange.bind(Object(l.a)(a)),a}return Object(i.a)(n,[{key:"render",value:function(){var e=this;return Object(b.jsxs)("div",{className:"mb-8",children:[Object(b.jsx)("label",{className:"text-sm font-medium text-gray-900 block",htmlFor:"twb"}),Object(b.jsx)("input",{className:"block cursor-pointer bg-gray-50 border border-gray-300 text-gray-900 focus:outline-none focus:border-transparent text-sm rounded-lg",type:"file",name:"twb",onChange:function(t){return e.handleChange(t)}})]})}}]),n}(s.a.Component);function m(e){return Object(b.jsx)("div",{className:"text-center my-8 text-4xl",children:Object(b.jsx)("h1",{children:e.children})})}var f=n(15),v=n(8);function O(e){return Object(b.jsx)("input",{className:"border appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",type:"text",name:e.name,id:e.id,defaultValue:e.defaultValue})}function x(e){return Object(b.jsx)("label",{className:"block text-gray-700 text-sm font-bold my-2",htmlFor:e.htmlFor,children:e.children})}var k=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={connectionXML:null,dbName:null,server:null,username:null,authentication:null,className:null,schema:null,service:null,port:null},a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this._setUpdate()}},{key:"componentDidUpdate",value:function(e){e.connection!==this.props.connection&&this._setUpdate()}},{key:"_setUpdate",value:function(){var e=this;this.setState((function(t,n){return{connectionXML:e.props.connection,dbName:e.props.connection.getAttribute("dbname"),server:e.props.connection.getAttribute("server"),username:e.props.connection.getAttribute("username"),authentication:e.props.connection.getAttribute("authentication"),className:e.props.connection.getAttribute("class"),schema:e.props.connection.getAttribute("schema"),service:e.props.connection.getAttribute("service"),port:e.props.connection.getAttribute("port")}}))}},{key:"render",value:function(){var e=this.state.className,t=this.state.dbName;return e&&t?Object(b.jsx)("section",{children:Object(b.jsxs)("div",{className:"bg-white border rounded px-8 pt-6 pb-8 mb-4",children:[Object(b.jsx)("h4",{className:"my-2 text-gray-400 font-bold",children:"Connection"}),Object(b.jsxs)("form",{action:"",children:[Object(b.jsx)(x,{htmlFor:"dbName",children:"DB Name: "}),Object(b.jsx)(O,{type:"text",name:"dbName",id:"",defaultValue:this.state.dbName})]})]})}):null}}]),n}(s.a.Component);function y(e){return Object(b.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500 border border-gray-300",children:e.children})}var g=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={columnXML:null,name:null,caption:null,datatype:null,role:null,type:null,calculation:null,description:null,usedIn:null},a._setUpdate=a._setUpdate.bind(Object(l.a)(a)),a._prepareCalculation=a._prepareCalculation.bind(Object(l.a)(a)),a._addUsedIn=a._addUsedIn.bind(Object(l.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this._setUpdate()}},{key:"componentDidUpdate",value:function(e){(e.column!==this.props.column||e.worksheetDatasources!==this.props.worksheetDatasources)&&this._setUpdate()}},{key:"_setUpdate",value:function(){var e=this;this.setState((function(t,n){return{columnXML:e.props.column,name:e.props.column.getAttribute("name"),caption:e.props.column.getAttribute("caption"),datatype:e.props.column.getAttribute("datatype"),role:e.props.column.getAttribute("role"),type:e.props.column.getAttribute("type"),calculation:e._prepareCalculation(e.props.column),description:e.props.column.getAttribute("description"),usedIn:e._addUsedIn()}}))}},{key:"_prepareCalculation",value:function(e){var t=null,n=e.getElementsByTagName("calculation")[0];return n&&(t=n.getAttribute("formula")),t}},{key:"_addUsedIn",value:function(){var e,t=[],n=this.props.worksheetDatasources,a=Object(v.a)(n);try{for(a.s();!(e=a.n()).done;){var s=e.value,r=s.datasourceDeps;if(r)r.columns.includes("[".concat(this.state.name,"]"))&&t.push(s.name)}}catch(c){a.e(c)}finally{a.f()}return t}},{key:"render",value:function(){return this.state.name?Object(b.jsxs)("tr",{children:[Object(b.jsx)(y,{children:this.state.name}),Object(b.jsx)(y,{children:this.state.caption}),Object(b.jsx)(y,{children:this.state.datatype}),Object(b.jsx)(y,{children:this.state.role}),Object(b.jsx)(y,{children:this.state.type}),Object(b.jsx)(y,{children:this.state.calculation}),Object(b.jsx)(y,{children:this.state.description}),Object(b.jsx)(y,{children:this.state.usedIn.join(", ")})]}):null}}]),n}(s.a.Component),D=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={opened:!1},a}return Object(i.a)(n,[{key:"handleClick",value:function(e){e.target&&this.setState((function(e,t){return{opened:!e.opened}}))}},{key:"render",value:function(){var e=this,t=this.state.opened;return Object(b.jsxs)("details",{className:"bg-white mb-3 p-3 rounded border",onClick:function(t){return e.handleClick(t)},children:[Object(b.jsxs)("summary",{children:[Object(b.jsx)("span",{className:"mx-2",children:this.props.icon}),Object(b.jsx)("h3",{children:this.props.title}),Object(b.jsx)("span",{className:"icon ".concat(t?"transform rotate-180":""),children:"\ud83d\udc47"})]}),Object(b.jsx)("div",{className:"mt-4",children:this.props.children})]})}}]),n}(s.a.Component);function _(e){return Object(b.jsx)("td",{className:"px-6 py-2 text-xs text-gray-500 border border-gray-300",children:e.children})}var w=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={datasourceXML:null,name:null,version:null,caption:null,connections:null,columns:null},a._setUpdate=a._setUpdate.bind(Object(l.a)(a)),a._prepareConnections=a._prepareConnections.bind(Object(l.a)(a)),a._prepareColumns=a._prepareColumns.bind(Object(l.a)(a)),a._filterWorksheets=a._filterWorksheets.bind(Object(l.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this._setUpdate()}},{key:"componentDidUpdate",value:function(e){e.datasource!==this.props.datasource&&this._setUpdate()}},{key:"_setUpdate",value:function(){var e=this;this.setState((function(t,n){return{datasourceXML:e.props.datasource,name:e.props.datasource.getAttribute("name"),version:e.props.datasource.getAttribute("version"),caption:e.props.datasource.getAttribute("caption"),connections:e._prepareConnections(e.props.datasource),columns:e._prepareColumns(e.props.datasource)}}))}},{key:"_prepareConnections",value:function(e){for(var t=[],n=e.getElementsByTagName("connection"),a=0;a<n.length;a++)t.push(n[a]);return t}},{key:"_prepareColumns",value:function(e){for(var t=[],n=e.getElementsByTagName("column"),a=0;a<n.length;a++)t.push(n[a]);return t}},{key:"_filterWorksheets",value:function(){var e,t=this,n=this.props.worksheetDatasources,a=[],s=Object(v.a)(n);try{for(s.s();!(e=s.n()).done;){var r=e.value,c=r.datasourceDeps.filter((function(e){return e.name===t.state.name}));a.push({name:r.worksheetName,datasourceDeps:c[0]})}}catch(o){s.e(o)}finally{s.f()}return a}},{key:"render",value:function(){var e=this.state.name,t=this.state.connections,n=this.state.caption,a=this.state.columns,s=this._filterWorksheets();return e?Object(b.jsxs)(D,{title:"".concat(n," - ").concat(e),children:[Object(b.jsx)("form",{className:"bg-white rounded px-8 pt-6 pb-8 mb-4",children:Object(b.jsxs)("div",{children:[Object(b.jsxs)("div",{children:[Object(b.jsx)(x,{htmlFor:"name",children:"Name"}),Object(b.jsx)(O,{name:"name",id:"",defaultValue:this.state.name})]}),Object(b.jsxs)("div",{children:[Object(b.jsx)(x,{htmlFor:"version",children:"Version"}),Object(b.jsx)(O,{name:"version",id:"",defaultValue:this.state.version})]}),Object(b.jsxs)("div",{children:[Object(b.jsx)(x,{htmlFor:"caption",children:"Caption"}),Object(b.jsx)(O,{name:"caption",id:"",defaultValue:this.state.caption})]})]})}),t.map((function(e,t){return Object(b.jsx)(k,{connection:e},t)})),Object(b.jsxs)("div",{className:"bg-white border rounded px-8 pt-6 pb-8 mb-4",children:[Object(b.jsx)("h4",{className:"my-2 text-gray-400 font-bold",children:"Columns"}),Object(b.jsx)("div",{className:"table-wrapper overflow-y-auto",children:Object(b.jsxs)("table",{className:"table-fixed border-separate border",children:[Object(b.jsx)("thead",{className:"bg-gray-50 sticky top-0",children:Object(b.jsxs)("tr",{children:[Object(b.jsx)(_,{children:"Name"}),Object(b.jsx)(_,{children:"Caption"}),Object(b.jsx)(_,{children:"Datatype"}),Object(b.jsx)(_,{children:"Role"}),Object(b.jsx)(_,{children:"Type"}),Object(b.jsx)(_,{children:"Calculation"}),Object(b.jsx)(_,{children:"Description"}),Object(b.jsx)(_,{children:"Used In"})]})}),Object(b.jsx)("tbody",{className:"bg-white",children:a.map((function(e,t){return Object(b.jsx)(g,{column:e,worksheetDatasources:s},t)}))})]})})]})]}):null}}]),n}(s.a.Component),N=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={worksheetXML:null,name:null,datasourceDependencies:null},a._setUpdate=a._setUpdate.bind(Object(l.a)(a)),a._DatasourceDepsToParent=a._DatasourceDepsToParent.bind(Object(l.a)(a)),a._prepareDatasourceDependencies=a._prepareDatasourceDependencies.bind(Object(l.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this._setUpdate()}},{key:"componentDidUpdate",value:function(e){e.workbook!==this.props.workbook&&this._setUpdate()}},{key:"_setUpdate",value:function(){var e=this;this.setState((function(t,n){return{datasourceXML:e.props.worksheet,name:e.props.worksheet.getAttribute("name"),datasourceDependencies:e._prepareDatasourceDependencies(e.props.worksheet)}}),(function(){e._DatasourceDepsToParent()}))}},{key:"_DatasourceDepsToParent",value:function(){this.props.addDatasourceDeps&&this.props.addDatasourceDeps(this.state.name,this.state.datasourceDependencies)}},{key:"_prepareDatasourceDependencies",value:function(e){for(var t=[],n=e.getElementsByTagName("datasource-dependencies"),a=0;a<n.length;a++){var s=n[a],r={name:"",columns:[]};r.name=s.getAttribute("datasource");for(var c=s.getElementsByTagName("column"),o=0;o<c.length;o++){var i=c[o].getAttribute("name");r.columns.push(i)}t.push(r)}return t}},{key:"render",value:function(){return this.state.name?Object(b.jsx)("li",{children:this.state.name}):""}}]),n}(s.a.Component),C=n(34),U=n(35),A=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={fileName:null,workbookXML:null,dashboards:null,datasources:null,worksheets:null,worksheetsDatasources:[]},a._setUpdate=a._setUpdate.bind(Object(l.a)(a)),a._prepareDashboards=a._prepareDashboards.bind(Object(l.a)(a)),a._prepareDatasources=a._prepareDatasources.bind(Object(l.a)(a)),a._prepareWorksheets=a._prepareWorksheets.bind(Object(l.a)(a)),a._addWorksheetDeps=a._addWorksheetDeps.bind(Object(l.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this._setUpdate()}},{key:"componentDidUpdate",value:function(e){e.workbook!==this.props.workbook&&this._setUpdate()}},{key:"_setUpdate",value:function(){var e=this;this.setState((function(t,n){return{fileName:e.props.workbook.file.name,workbookXML:e.props.workbook.xmlDoc,dashboards:e._prepareDashboards(e.props.workbook.xmlDoc),datasources:e._prepareDatasources(e.props.workbook.xmlDoc),worksheets:e._prepareWorksheets(e.props.workbook.xmlDoc)}}))}},{key:"_prepareDashboards",value:function(e){var t=[],n=e.getElementsByTagName("dashboards")[0].children;if(!n)return[];var a,s=Object(v.a)(n);try{for(s.s();!(a=s.n()).done;){var r=a.value.getAttribute("name");t.push(r)}}catch(c){s.e(c)}finally{s.f()}return t}},{key:"_prepareDatasources",value:function(e){var t=[],n=e.getElementsByTagName("datasources")[0].children;if(!n)return[];var a,s=Object(v.a)(n);try{for(s.s();!(a=s.n()).done;){var r=a.value;t.push(r)}}catch(c){s.e(c)}finally{s.f()}return t}},{key:"_prepareWorksheets",value:function(e){var t=[],n=e.getElementsByTagName("worksheets")[0].children;if(!n)return[];var a,s=Object(v.a)(n);try{for(s.s();!(a=s.n()).done;){var r=a.value;t.push(r)}}catch(c){s.e(c)}finally{s.f()}return t}},{key:"_addWorksheetDeps",value:function(e,t){var n={worksheetName:e,datasourceDeps:t};this.setState((function(e){return{worksheetsDatasources:[].concat(Object(f.a)(e.worksheetsDatasources),[n])}}))}},{key:"_checkFieldsUsage",value:function(e,t){var n,a=Object(v.a)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;for(var r in s.datasourceDependencies){var c=s.datasourceDependencies[r],o=t[c.name];for(var i in o.columns){var l=o.columns[i];c.columns.includes(l.name)&&l.addUsedIn(s.name)}}}}catch(u){a.e(u)}finally{a.f()}}},{key:"save",value:function(){var e=(new XMLSerializer).serializeToString(this._workbookXML),t=document.createElement("a");t.setAttribute("href","data:text/twb;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",this._fileName),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}},{key:"render",value:function(){var e=this,t=this.state.datasources,n=this.state.worksheets,a=this.state.worksheetsDatasources;return t&&n?Object(b.jsxs)("section",{children:[Object(b.jsx)("div",{className:"mb-4 border-b-2",children:Object(b.jsx)("h2",{className:"text-2xl mb-4",children:Object(b.jsx)("span",{children:this.state.fileName})})}),Object(b.jsx)(D,{title:"Datasources",icon:Object(b.jsx)(C.a,{}),children:t.map((function(e,t){return Object(b.jsx)(w,{datasource:e,worksheetDatasources:a},t)}))}),Object(b.jsx)(D,{title:"Worksheets",icon:Object(b.jsx)(U.a,{}),children:Object(b.jsx)("ul",{className:"list-disc list-inside",children:n.map((function(t,n){return Object(b.jsx)(N,{worksheet:t,addDatasourceDeps:e._addWorksheetDeps},n)}))})})]}):null}}]),n}(s.a.Component),M=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={file:null,xmlDoc:null},a.add=a.add.bind(Object(l.a)(a)),a.loaded=a.loaded.bind(Object(l.a)(a)),a}return Object(i.a)(n,[{key:"add",value:function(e){var t=this;this.setState({file:e},(function(){return t.loaded()}))}},{key:"loaded",value:function(){var e=this,t=new DOMParser,n=this.state.file,a=n.name.split(".").slice(-1)[0];if("twbx"===a)(new h.a).loadAsync(n).then((function(n){var a=Object.keys(n.files).find((function(e){return e.includes(".twb")}));n.files[a].async("string").then((function(n){if(!n)return e.errorMessage="No twb file found";var a=t.parseFromString(n,"text/xml");e.setState({xmlDoc:a})}))}));else if("twb"===a){var s=new FileReader;s.onload=function(n){var a=t.parseFromString(n.target.result,"text/xml");e.setState({xmlDoc:a})},s.readAsText(n,"UTF-8")}}},{key:"render",value:function(){var e=this.state.file,t=this.state.xmlDoc;return e&&t?Object(b.jsxs)("div",{className:"container mx-auto px-4",children:[Object(b.jsx)(m,{children:"Workbook"}),Object(b.jsx)(j,{addEvent:this.add,loadedEvent:this.loaded}),Object(b.jsx)(A,{workbook:this.state})]}):Object(b.jsxs)("div",{className:"container mx-auto px-4",children:[Object(b.jsx)(m,{children:"Workbook"}),Object(b.jsx)(j,{addEvent:this.add})]})}}]),n}(s.a.Component);n(31);var T=function(){return Object(b.jsx)("div",{className:"App",children:Object(b.jsx)("main",{children:Object(b.jsx)(M,{})})})},S=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,36)).then((function(t){var n=t.getCLS,a=t.getFID,s=t.getFCP,r=t.getLCP,c=t.getTTFB;n(e),a(e),s(e),r(e),c(e)}))};c.a.render(Object(b.jsx)(s.a.StrictMode,{children:Object(b.jsx)(T,{})}),document.getElementById("root")),S()}},[[32,1,2]]]);
//# sourceMappingURL=main.00b9a907.chunk.js.map