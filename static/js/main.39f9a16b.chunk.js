(this["webpackJsonpdata-utils"]=this["webpackJsonpdata-utils"]||[]).push([[0],{17:function(e,t,a){},28:function(e,t,a){},29:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a.n(n),r=a(11),c=a.n(r),o=(a(17),a(3)),i=a(4),l=a(2),u=a(6),d=a(5),p=a(12),h=a.n(p),b=a(0),m=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).handleChange=function(e){var t=e.target.files[0];t&&n.setState({file:t},(function(){n.props.addEvent&&n.props.addEvent(n.state.file)}))},n.state={file:void 0},n.handleChange=n.handleChange.bind(Object(l.a)(n)),n}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return Object(b.jsxs)("div",{className:"mb-8",children:[Object(b.jsx)("label",{className:"text-sm font-medium text-gray-900 block",htmlFor:"twb"}),Object(b.jsx)("input",{className:"block cursor-pointer bg-gray-50 border border-gray-300 text-gray-900 focus:outline-none focus:border-transparent text-sm rounded-lg",type:"file",name:"twb",onChange:function(t){return e.handleChange(t)}})]})}}]),a}(s.a.Component);function j(e){return Object(b.jsx)("div",{className:"text-center my-8 text-4xl",children:Object(b.jsx)("h1",{children:e.children})})}var x=a(8);function f(e){return Object(b.jsx)("input",{className:"border appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",type:"text",name:e.name,id:e.id,defaultValue:e.defaultValue})}function v(e){return Object(b.jsx)("label",{className:"block text-gray-700 text-sm font-bold my-2",htmlFor:e.htmlFor,children:e.children})}var O=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={connectionXML:null,dbName:null,server:null,username:null,authentication:null,className:null,schema:null,service:null,port:null},n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this._setUpdate()}},{key:"componentDidUpdate",value:function(e){e.connection!==this.props.connection&&this._setUpdate()}},{key:"_setUpdate",value:function(){var e=this;this.setState((function(t,a){return{connectionXML:e.props.connection,dbName:e.props.connection.getAttribute("dbname"),server:e.props.connection.getAttribute("server"),username:e.props.connection.getAttribute("username"),authentication:e.props.connection.getAttribute("authentication"),className:e.props.connection.getAttribute("class"),schema:e.props.connection.getAttribute("schema"),service:e.props.connection.getAttribute("service"),port:e.props.connection.getAttribute("port")}}))}},{key:"render",value:function(){var e=this.state.className,t=this.state.dbName;return e&&t?Object(b.jsx)("section",{children:Object(b.jsxs)("div",{className:"bg-white border rounded px-8 pt-6 pb-8 mb-4",children:[Object(b.jsx)("h4",{className:"my-2",children:"Connection"}),Object(b.jsxs)("form",{action:"",children:[Object(b.jsx)(v,{htmlFor:"dbName",children:"DB Name: "}),Object(b.jsx)(f,{type:"text",name:"dbName",id:"",defaultValue:this.state.dbName})]})]})}):null}}]),a}(s.a.Component),y=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={columnXML:null,name:null,caption:null,datatype:null,role:null,type:null,calculation:null,description:null,usedIn:null},n._setUpdate=n._setUpdate.bind(Object(l.a)(n)),n._prepareCalculation=n._prepareCalculation.bind(Object(l.a)(n)),n._addUsedIn=n._addUsedIn.bind(Object(l.a)(n)),n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this._setUpdate()}},{key:"componentDidUpdate",value:function(e){(e.column!==this.props.column||e.worksheetDatasources!==this.props.worksheetDatasources)&&this._setUpdate()}},{key:"_setUpdate",value:function(){var e=this;this.setState((function(t,a){return{columnXML:e.props.column,name:e.props.column.getAttribute("name"),caption:e.props.column.getAttribute("caption"),datatype:e.props.column.getAttribute("datatype"),role:e.props.column.getAttribute("role"),type:e.props.column.getAttribute("type"),calculation:e._prepareCalculation(e.props.column),description:e.props.column.getAttribute("description"),usedIn:e._addUsedIn()}}))}},{key:"_prepareCalculation",value:function(e){var t=null,a=e.getElementsByTagName("calculation")[0];return a&&(t=a.getAttribute("formula")),t}},{key:"_addUsedIn",value:function(){var e,t=[],a=this.props.worksheetDatasources,n=Object(x.a)(a);try{for(n.s();!(e=n.n()).done;){var s=e.value,r=s.datasourceDeps;if(r)r.columns.includes(this.state.name)&&t.push(s.name)}}catch(c){n.e(c)}finally{n.f()}return t.length<1||void 0===t?"unused":t}},{key:"render",value:function(){return this.state.name?Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:this.state.name}),Object(b.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:this.state.caption}),Object(b.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:this.state.datatype}),Object(b.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:this.state.role}),Object(b.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:this.state.type}),Object(b.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:this.state.calculation}),Object(b.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:this.state.description}),Object(b.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:this.state.usedIn})]}):null}}]),a}(s.a.Component),k=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={opened:!1},n}return Object(i.a)(a,[{key:"handleClick",value:function(e){e.target&&this.setState((function(e,t){return{opened:!e.opened}}))}},{key:"render",value:function(){var e=this,t=this.state.opened;return Object(b.jsxs)("details",{className:"bg-white mb-3 p-3 rounded border",onClick:function(t){return e.handleClick(t)},children:[Object(b.jsxs)("summary",{children:[Object(b.jsx)("span",{className:"mx-2",children:this.props.icon}),Object(b.jsx)("h3",{children:this.props.title}),Object(b.jsx)("span",{className:"icon ".concat(t?"transform rotate-180":""),children:"\ud83d\udc47"})]}),Object(b.jsx)("div",{className:"mt-4",children:this.props.children})]})}}]),a}(s.a.Component),g=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={datasourceXML:null,name:null,version:null,caption:null,connections:null,columns:null},n._setUpdate=n._setUpdate.bind(Object(l.a)(n)),n._prepareConnections=n._prepareConnections.bind(Object(l.a)(n)),n._prepareColumns=n._prepareColumns.bind(Object(l.a)(n)),n._filterWorksheets=n._filterWorksheets.bind(Object(l.a)(n)),n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this._setUpdate()}},{key:"componentDidUpdate",value:function(e){e.datasource!==this.props.datasource&&this._setUpdate()}},{key:"_setUpdate",value:function(){var e=this;this.setState((function(t,a){return{datasourceXML:e.props.datasource,name:e.props.datasource.getAttribute("name"),version:e.props.datasource.getAttribute("version"),caption:e.props.datasource.getAttribute("caption"),connections:e._prepareConnections(e.props.datasource),columns:e._prepareColumns(e.props.datasource)}}))}},{key:"_prepareConnections",value:function(e){for(var t=[],a=e.getElementsByTagName("connection"),n=0;n<a.length;n++)t.push(a[n]);return t}},{key:"_prepareColumns",value:function(e){for(var t=[],a=e.getElementsByTagName("column"),n=0;n<a.length;n++)t.push(a[n]);return t}},{key:"_filterWorksheets",value:function(){var e=this,t=this.props.worksheetDatasources,a=[];return t.map((function(t,n){var s=t.datasourceDeps.filter((function(t){return t.name===e.state.name}));a.push({name:t.worksheetName,datasourceDeps:s[0]})})),a}},{key:"render",value:function(){var e=this.state.name,t=this.state.connections,a=this.state.caption,n=this.state.columns,s=this._filterWorksheets();return e?Object(b.jsxs)(k,{title:"".concat(a," - ").concat(e),children:[Object(b.jsx)("form",{className:"bg-white border rounded px-8 pt-6 pb-8 mb-4",children:Object(b.jsxs)("div",{children:[Object(b.jsxs)("div",{children:[Object(b.jsx)(v,{htmlFor:"name",children:"Name"}),Object(b.jsx)(f,{name:"name",id:"",defaultValue:this.state.name})]}),Object(b.jsxs)("div",{children:[Object(b.jsx)(v,{htmlFor:"version",children:"Version"}),Object(b.jsx)(f,{type:"text",name:"version",id:"",defaultValue:this.state.version})]}),Object(b.jsxs)("div",{children:[Object(b.jsx)(v,{htmlFor:"caption",children:"Caption"}),Object(b.jsx)(f,{type:"text",name:"caption",id:"",defaultValue:this.state.caption})]})]})}),t.map((function(e,t){return Object(b.jsx)(O,{connection:e},t)})),Object(b.jsxs)("div",{className:"bg-white border rounded px-8 pt-6 pb-8 mb-4",children:[Object(b.jsx)("h4",{className:"my-2",children:"Columns"}),Object(b.jsx)("div",{className:"table-wrapper overflow-y-auto overflow-x-hidden",children:Object(b.jsxs)("table",{className:"table-fixed",children:[Object(b.jsx)("thead",{className:"bg-gray-50 sticky top-0",children:Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{className:"px-6 py-2 text-xs text-gray-500",children:"Name"}),Object(b.jsx)("th",{className:"px-6 py-2 text-xs text-gray-500",children:"Caption"}),Object(b.jsx)("th",{className:"px-6 py-2 text-xs text-gray-500",children:"Datatype"}),Object(b.jsx)("th",{className:"px-6 py-2 text-xs text-gray-500",children:"Role"}),Object(b.jsx)("th",{className:"px-6 py-2 text-xs text-gray-500",children:"Type"}),Object(b.jsx)("th",{className:"px-6 py-2 text-xs text-gray-500",children:"Calculation"}),Object(b.jsx)("th",{className:"px-6 py-2 text-xs text-gray-500",children:"Description"}),Object(b.jsx)("th",{className:"px-6 py-2 text-xs text-gray-500",children:"Used In"})]})}),Object(b.jsx)("tbody",{className:"bg-white",children:n.map((function(e,t){return Object(b.jsx)(y,{column:e,worksheetDatasources:s},t)}))})]})})]})]}):null}}]),a}(s.a.Component),D=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={worksheetXML:null,name:null,datasourceDependencies:null},n._setUpdate=n._setUpdate.bind(Object(l.a)(n)),n._DatasourceDepsToParent=n._DatasourceDepsToParent.bind(Object(l.a)(n)),n._prepareDatasourceDependencies=n._prepareDatasourceDependencies.bind(Object(l.a)(n)),n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this._setUpdate()}},{key:"componentDidUpdate",value:function(e){e.workbook!==this.props.workbook&&this._setUpdate()}},{key:"_setUpdate",value:function(){var e=this;this.setState((function(t,a){return{datasourceXML:e.props.worksheet,name:e.props.worksheet.getAttribute("name"),datasourceDependencies:e._prepareDatasourceDependencies(e.props.worksheet)}}),(function(){return e._DatasourceDepsToParent()}))}},{key:"_DatasourceDepsToParent",value:function(){this.props.addDatasourceDeps&&this.props.addDatasourceDeps(this.state.name,this.state.datasourceDependencies)}},{key:"_prepareDatasourceDependencies",value:function(e){for(var t=[],a=e.getElementsByTagName("datasource-dependencies"),n=0;n<a.length;n++){var s=a[n],r={name:"",columns:[]};r.name=s.getAttribute("datasource");for(var c=s.getElementsByTagName("column"),o=0;o<c.length;o++){var i=c[o].getAttribute("name");r.columns.push(i)}t.push(r)}return t}},{key:"render",value:function(){return this.state.name?Object(b.jsx)("li",{children:this.state.name}):""}}]),a}(s.a.Component),_=a(31),N=a(32),w=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={fileName:null,workbookXML:null,dashboards:null,datasources:null,worksheets:null,worksheetsDatasources:[]},n._setUpdate=n._setUpdate.bind(Object(l.a)(n)),n._prepareDashboards=n._prepareDashboards.bind(Object(l.a)(n)),n._prepareDatasources=n._prepareDatasources.bind(Object(l.a)(n)),n._prepareWorksheets=n._prepareWorksheets.bind(Object(l.a)(n)),n._addWorksheetDeps=n._addWorksheetDeps.bind(Object(l.a)(n)),n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this._setUpdate()}},{key:"componentDidUpdate",value:function(e){e.workbook!==this.props.workbook&&this._setUpdate()}},{key:"_setUpdate",value:function(){var e=this;this.setState((function(t,a){return{fileName:e.props.workbook.file.name,workbookXML:e.props.workbook.xmlDoc,dashboards:e._prepareDashboards(e.props.workbook.xmlDoc),datasources:e._prepareDatasources(e.props.workbook.xmlDoc),worksheets:e._prepareWorksheets(e.props.workbook.xmlDoc)}}))}},{key:"_prepareDashboards",value:function(e){var t=[],a=e.getElementsByTagName("dashboards")[0].children;if(!a)return[];var n,s=Object(x.a)(a);try{for(s.s();!(n=s.n()).done;){var r=n.value.getAttribute("name");t.push(r)}}catch(c){s.e(c)}finally{s.f()}return t}},{key:"_prepareDatasources",value:function(e){var t=[],a=e.getElementsByTagName("datasources")[0].children;if(!a)return[];var n,s=Object(x.a)(a);try{for(s.s();!(n=s.n()).done;){var r=n.value;t.push(r)}}catch(c){s.e(c)}finally{s.f()}return t}},{key:"_prepareWorksheets",value:function(e){var t=[],a=e.getElementsByTagName("worksheets")[0].children;if(!a)return[];var n,s=Object(x.a)(a);try{for(s.s();!(n=s.n()).done;){var r=n.value;t.push(r)}}catch(c){s.e(c)}finally{s.f()}return t}},{key:"_addWorksheetDeps",value:function(e,t){this.setState({worksheetsDatasources:this.state.worksheetsDatasources.concat({worksheetName:e,datasourceDeps:t})})}},{key:"_checkFieldsUsage",value:function(e,t){var a,n=Object(x.a)(e);try{for(n.s();!(a=n.n()).done;){var s=a.value;for(var r in s.datasourceDependencies){var c=s.datasourceDependencies[r],o=t[c.name];for(var i in o.columns){var l=o.columns[i];c.columns.includes(l.name)&&l.addUsedIn(s.name)}}}}catch(u){n.e(u)}finally{n.f()}}},{key:"save",value:function(){var e=(new XMLSerializer).serializeToString(this._workbookXML),t=document.createElement("a");t.setAttribute("href","data:text/twb;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",this._fileName),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}},{key:"render",value:function(){var e=this,t=this.state.datasources,a=this.state.worksheets,n=this.state.worksheetsDatasources;return t&&a?Object(b.jsxs)("section",{children:[Object(b.jsx)("div",{className:"mb-4 border-b-2",children:Object(b.jsx)("h2",{className:"text-2xl mb-4",children:Object(b.jsx)("span",{children:this.state.fileName})})}),Object(b.jsx)(k,{title:"Datasources",icon:Object(b.jsx)(_.a,{}),children:t.map((function(e,t){return Object(b.jsx)(g,{datasource:e,worksheetDatasources:n},t)}))}),Object(b.jsx)(k,{title:"Worksheets",icon:Object(b.jsx)(N.a,{}),children:Object(b.jsx)("ul",{children:a.map((function(t,a){return Object(b.jsx)(D,{worksheet:t,addDatasourceDeps:e._addWorksheetDeps},a)}))})})]}):null}}]),a}(s.a.Component),C=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={file:null,xmlDoc:null},n.add=n.add.bind(Object(l.a)(n)),n.loaded=n.loaded.bind(Object(l.a)(n)),n}return Object(i.a)(a,[{key:"add",value:function(e){var t=this;this.setState({file:e},(function(){return t.loaded()}))}},{key:"loaded",value:function(){var e=this,t=new DOMParser,a=this.state.file,n=a.name.split(".").slice(-1)[0];if("twbx"===n)(new h.a).loadAsync(a).then((function(a){var n=Object.keys(a.files).find((function(e){return e.includes(".twb")}));a.files[n].async("string").then((function(a){if(!a)return e.errorMessage="No twb file found";var n=t.parseFromString(a,"text/xml");e.setState({xmlDoc:n})}))}));else if("twb"===n){var s=new FileReader;s.onload=function(a){var n=t.parseFromString(a.target.result,"text/xml");e.setState({xmlDoc:n})},s.readAsText(a,"UTF-8")}}},{key:"render",value:function(){var e=this.state.file,t=this.state.xmlDoc;return e&&t?Object(b.jsxs)("div",{className:"container mx-auto px-4",children:[Object(b.jsx)(j,{children:"Workbook"}),Object(b.jsx)(m,{addEvent:this.add,loadedEvent:this.loaded}),Object(b.jsx)(w,{workbook:this.state})]}):Object(b.jsxs)("div",{className:"container mx-auto px-4",children:[Object(b.jsx)(j,{children:"Workbook"}),Object(b.jsx)(m,{addEvent:this.add})]})}}]),a}(s.a.Component);a(28);var U=function(){return Object(b.jsx)("div",{className:"App",children:Object(b.jsx)("main",{children:Object(b.jsx)(C,{})})})},A=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,33)).then((function(t){var a=t.getCLS,n=t.getFID,s=t.getFCP,r=t.getLCP,c=t.getTTFB;a(e),n(e),s(e),r(e),c(e)}))};c.a.render(Object(b.jsx)(s.a.StrictMode,{children:Object(b.jsx)(U,{})}),document.getElementById("root")),A()}},[[29,1,2]]]);
//# sourceMappingURL=main.39f9a16b.chunk.js.map